<div class="container mt-4">
  <div class="row">
    <div class="col-sm-4">
        <h4>Редакция на обява</h4>
    </div>
    <div class="col-sm-8">
      <div *ngIf="editForm?.dirty" class="alert alert-info">
        <strong>Информация:</strong> Вие направихте промени. Всички незапазени промени ще бъдат изтрити!
      </div>
    </div>
  </div>
  <div class="row mb-4">
    <div class="col-sm-4"> <!-- left part -->
      <div class="card">
        <ng-container *ngIf="ad?.photoUrl !== null;else NoPhoto">
          <img src="{{ad.photoUrl}}" alt="{{ad.id}}" class="card-img-top img-thumbnail" style="width:350px;height:350px;">
        </ng-container>
        <ng-template #NoPhoto>
          <img src="https://www.tibs.org.tw/images/default.jpg" class="card-img-top img-thumbnail" style="width:350px;height:350px;">
        </ng-template>
        <div class="card-body">
          <div>
            <strong>Заглавие:</strong> {{ad.title}}
          </div>
          <div *ngIf="ad.price == null">
            <strong>Цена:</strong> По договаряне
          </div>
          <div *ngIf="ad.price != null && ad.price == 0">
            <strong>Цена:</strong> Безплатно
          </div>
          <div *ngIf="ad.price != null && ad.price != 0">
            <strong>Цена:</strong> {{ad.price}} лв.
          </div>
          <div>
            <strong>Адрес:</strong> {{ad.location}}
          </div>
          <div>
            <strong>Категория:</strong> {{ad.categoryName}}
          </div>
          <div>
            <strong>Добавена:</strong> {{ad.dateAdded | date}}
          </div>
          <div *ngIf="ad?.isUsed!=null">
            <strong>Състояние: </strong><ng-container *ngIf="ad?.isUsed;else Other">използвано</ng-container><ng-template #Other>ново</ng-template>
          </div>
        </div>
        <div class="card-footer" *ngIf="!this.adTabs.tabs[2].active">
          <div class="btn-group d-flex">
            <button *ngIf="this.adTabs.tabs[0].active" [disabled]="!editForm?.dirty" form="editForm" class="btn btn-success btn-block">Редакция</button>
            <button *ngIf="this.adTabs.tabs[1].active" [disabled]="!descriptionForm?.dirty" form="descriptionForm" class="btn btn-success btn-block">Редакция</button>
          </div>
        </div>
      </div>
    </div>
    <div class="col-sm-8"> <!-- right part -->
      <div class="tab-panel">
        <tabset class="ad-tabset" #adTabs>
            <tab heading="Детайли">
                <form #editForm="ngForm" id="editForm" name="editForm" (ngSubmit)="updateAd()">
                    <h6>Заглавие на обявата</h6>
                    <input type="text" class="form-control" name="title" [(ngModel)]="ad.title">
                    <h6 class="mt-2">Категория</h6>
                    <select class="form-control" [(ngModel)]="ad.categoryId" name="categoryId" (change)="onCategorySelect()">
                      <option *ngFor="let category of categories" [ngValue]="category.id">{{category.name}}</option>
                    </select>
                    <h6 class="mt-2">Адрес</h6>
                    <input type="text" class="form-control" name="location" [(ngModel)]="ad.location">
                    <h6 class="mt-2">Цена</h6>
                    <input type="number" class="form-control" name="price" [(ngModel)]="ad.price" min="0" oninput="validity.valid||(value='');">
                    <!--<h6 *ngIf="ad.isUsed!==null" class="mt-2">Състояние <input class="ml-2" type="checkbox" name="isUsed" [(ngModel)]="ad.isUsed"/></h6>-->
                    <div *ngIf="ad.isUsed!==null">
                      <h6 class="mt-2">Състояние</h6>
                      <select class="form-control" [(ngModel)]="ad.isUsed" name="isUsed">
                        <!--<option [ngValue]=null></option>-->
                        <option [ngValue]="true">използвано</option>
                        <option [ngValue]="false">ново</option>
                      </select>
                    </div>
                </form>
            </tab>
            <tab heading="Описание">
              <form #descriptionForm="ngForm" id="descriptionForm" name="descriptionForm" (ngSubmit)="updateAd()">
                <textarea class="form-control" name="description" rows="10" 
                      [(ngModel)]="ad.description" pre></textarea>
              </form>
            </tab>
            <tab heading="Снимки">
              <photo-editor [photos]="ad.photos" [adId]="ad.id" (getAdPhotoChange)="updateMainPhoto($event)"></photo-editor>
            </tab>
        </tabset>
      </div>
    </div>
  </div>
</div>
